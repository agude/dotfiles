name: Test Install

on: [push, pull_request]

jobs:
  lint:
    name: Lint Shell Scripts
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@2.0.0
        with:
          # Scan all shell-like scripts.
          scandir: './'
          # Ignore the zsh directory, as shellcheck does not fully support its syntax.
          ignore_paths: zsh
          # Only fail the build on actual errors, not warnings or style suggestions.
          #severity: error

  install:
    name: Test Install on ${{ matrix.os }}
    needs: lint
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]

    steps:
    - uses: actions/checkout@v4

    - name: Install Dependencies (Linux)
      if: runner.os == 'Linux'
      run: |
        sudo apt-get update
        sudo apt-get install -y neovim zsh

    - name: Install Dependencies (macOS)
      if: runner.os == 'macOS'
      run: brew install neovim

    - name: Run the installation script
      run: ./install.sh

    - name: Test idempotency
      run: ./install.sh

    - name: Test nvim startup
      run: nvim +qall

    - name: Test bashrc
      run: bash -c "source ~/.bashrc"

    - name: Test zshrc
      run: zsh -c "source ~/.zshrc"
