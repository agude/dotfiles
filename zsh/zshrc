# ------------------------------------------------------------------------------
# Main Zsh configuration file.
# This file sets up the environment and then sources modular configuration
# files from the ~/.zshrc.d/ directory.
# ------------------------------------------------------------------------------

# --- Early Environment Setup ---

# For security, set a restrictive umask. New files will only be readable by you.
umask 077

# --- PATH Management ---

# Use zsh's built-in `typeset` to ensure the PATH contains only unique entries.
# This prevents the PATH from growing with duplicate directories on re-sourcing.
typeset -U path

# Prepend user-specific bin directories to the PATH.
# Prepending ensures they are found before system binaries.
path=(
    "$HOME/.local/bin"
    "$HOME/bin"
    $path
)

# --- Shell Options & Behavior ---

# Don't offer spelling correction for commands.
unsetopt CORRECT

# Disable automatic terminal title setting by some frameworks (like Oh My Zsh).
# This allows custom prompts to control the title.
DISABLE_AUTO_TITLE="true"

# --- Loading Configuration Files ---

# Source all .zsh configuration files from the ~/.zshrc.d directory.
# The glob qualifier (n) ensures they are sourced in explicit numerical order.
SHARED_DIR="$HOME/.sharedrc.d"
if [[ -d "$SHARED_DIR" ]]; then
  for config_file in "$SHARED_DIR/"*.sh(n); do
    [[ -f "$config_file" ]] && source "$config_file"
  done
fi
ZSH_DIR="$HOME/.zshrc.d"
if [[ -d "$ZSH_DIR" ]]; then
  for config_file in "$ZSH_DIR/"*.zsh(n); do
    [[ -f "$config_file" ]] && source "$config_file"
  done
fi

# Load a local, machine-specific aliases file if it exists.
# This is for aliases that should not be checked into version control.
[[ -f "$HOME/.localaliases" ]] && source "$HOME/.localaliases"

# --- Cleanup ---
unset config_file
